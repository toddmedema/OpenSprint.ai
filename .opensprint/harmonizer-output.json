{
  "status": "success",
  "prd_updates": [
    {
      "section": "feature_list",
      "action": "update",
      "content": "### Sketch Phase\n- Conversational PRD creation with Dreamer agent\n- Living document with section-level versioning\n- Architecture definition (tech stack, data models, API contracts)\n- Mockup generation and iteration\n- Proactive challenge of assumptions and edge cases\n- Split-pane UI: chat + live PRD\n\n### Plan Phase\n- AI-assisted decomposition into features and tasks\n- Plan markdown specification (`.opensprint/plans/<plan-id>.md`)\n- Dependency graph visualization\n- \"Execute!\" transition with cross-epic dependency check\n- Harmonizer for PRD sync on Execute!\n- Re-execute with Auditor for delta task generation\n\n### Execute Phase\n- Automatic task decomposition via Planner\n- Epic card interface with task status (Planning, Backlog, Ready, In Progress, In Review, Done, Blocked)\n- Two-agent Coder → Reviewer cycle\n- Real-time agent monitoring and output streaming\n- Summarizer for context when >2 deps or >2,000-word Plan\n- Git working mode: Worktree (isolated worktrees per task) or Branches (main repo on task branches); configurable in Agent Config\n- Progressive backoff on failures\n\n### Evaluate Phase\n- Feedback submission in natural language\n- Analyst categorization (bug/feature/UX/scope) and mapping to epics\n- Harmonizer for scope-change PRD updates\n- Feedback history feed\n\n### Deliver Phase\n- Automated deployment (Expo.dev or custom pipeline)\n- Pre-deployment test gate with fix epic on failure\n- Deployment history and rollback\n- Environment configuration (staging, production)\n\n### Project Setup & Configuration\n- Home screen with project cards\n- Setup wizard: name, agents, deployment, HIL, repo init\n- Two agent slots: Planning (Dreamer, Planner, Harmonizer, Analyst, Summarizer, Auditor) and Coding (Coder, Reviewer)\n- Git working mode: Worktree (default) or Branches; when Branches, parallel coders disabled and Parallelism section hidden\n- HIL: Scope Changes, Architecture Decisions, Dependency Modifications — each with Automated / Notify and proceed / Requires approval\n- Light/dark/system theme",
      "change_log_entry": "Added Git working mode (Worktree/Branches) to Execute Phase and Project Setup."
    },
    {
      "section": "technical_architecture",
      "action": "update",
      "content": "### Architecture Overview\n\nThree primary layers: web frontend, backend API server, and background agent CLI. Frontend uses WebSockets for real-time updates and REST for CRUD. Backend orchestrates agent CLIs, manages project state, and maintains the living PRD. Fully offline-capable with local agents.\n\n### Technology Stack\n\n- **Backend:** Node.js + TypeScript (subprocess management, WebSocket, beads CLI via `child_process.exec()`)\n- **Frontend:** React + TypeScript\n- **Task store:** Beads (git-based, CLI `bd` with `--json`)\n- **Version control:** Git, branch-per-task; Worktree mode: isolated worktrees; Branches mode: main repo with task branches (configurable in Agent Config)\n\n### Core Components\n\n| Component           | Responsibility |\n| ------------------- | -------------- |\n| Web Frontend        | UI for all five phases; real-time agent monitoring |\n| Backend API         | Project state, WebSocket relay, PRD versioning, agent orchestration |\n| Agent CLI           | Code generation, testing, debugging (Claude/Cursor/Custom) |\n| Orchestration Layer | Deterministic Node.js; agent lifecycle; git/task ops; commit queue; watchdog |\n| Beads               | Issue CRUD, dependencies, `bd ready`, assignee, hierarchical IDs |\n| Test Runner         | Jest, Playwright, etc. — auto-detected from `package.json` |\n| Deployment          | Expo.dev or custom pipeline |\n\n### Orchestrator Trust Boundary\n\nOrchestrator owns: worktree/branch management (Worktree mode) or branch-only management (Branches mode), commits/merges, agent triggering, beads state transitions, beads issue creation, PRD updates (except Dreamer direct write), gating task closure. Agents produce outputs; orchestrator performs all critical operations.\n\n### Data Flow\n\nSketch → PRD. Plan → Plan markdowns (epics). Execute → tasks in beads. Agent CLIs execute tasks. Evaluate → feedback mapped to epics/tasks. Changes propagate upstream to PRD.\n\n### Orchestrator Lifecycle\n\nOne orchestrator per project, always on. Single Coder/Reviewer at a time (v1); Planning-slot agents concurrent. Event-driven + 5-min watchdog. State in `.opensprint/orchestrator-state.json`; recovery on crash.\n\n### Git Concurrency\n\nSerialized commit queue for main-branch ops. Beads auto-commit disabled; orchestrator manages persistence.",
      "change_log_entry": "Documented Git working mode (Worktree vs Branches) in Version control and Orchestrator Trust Boundary."
    },
    {
      "section": "data_model",
      "action": "update",
      "content": "### Entity Relationship\n\n```\nUser (implicit)\n  └── Project (1:many)\n        ├── PRD (1:1, .opensprint/prd.json)\n        ├── Conversation (1:many, per phase)\n        ├── Plan (1:many, .opensprint/plans/*.md)\n        │     └── Task (beads issues, parent-child IDs)\n        │           └── AgentSession (1:many)\n        ├── FeedbackItem (1:many)\n        ├── DeploymentRecord (1:many)\n        └── Settings (1:1)\n```\n\n### Key Entities\n\n- **Project:** id, name, repo_path, current_phase\n- **PRD:** version, sections (content, version, updated_at), change_log\n- **Plan:** plan_id, bead_epic_id, gate_task_id, shipped_at, complexity\n- **Task (beads):** id, title, description, status, priority, assignee, labels, dependencies\n- **AgentSession:** task_id, attempt, status, output_log, test_results\n- **FeedbackItem:** text, category, mapped_plan_id, created_task_ids, status\n- **DeploymentRecord:** commit_hash, target, mode, status, url\n- **Settings:** gitWorkingMode (worktree|branches), planning_agent, coding_agent, deployment, hil_config, test_framework, test_command\n\n### Storage\n\n- **Project index:** `~/.opensprint/projects.json`\n- **Per-project:** `.opensprint/`, beads in `.beads/` — version-controlled",
      "change_log_entry": "Added gitWorkingMode to Settings entity in data model."
    }
  ]
}
