{
  "title": "Clearer API Key Setup Flow",
  "content": "# Clearer API Key Setup Flow\n\n## Overview\n\nImprove first-time user onboarding by moving API keys to a global settings level and showing a focused modal when users attempt to create or add a project without any API keys configured. Users can either add an agent API key (Claude or Cursor) or opt into Custom/CLI mode, which skips API key prompts for future projects.\n\n## Acceptance Criteria\n\n- API keys stored at global level in `~/.opensprint/global-settings.json`, not per project; rate/usage limit tracking (`limitHitAt`) stored globally\n- When user clicks \"Create New\" or \"Add Existing\" and has no API keys and has not selected Custom/CLI: show modal \"Enter agent API key\"\n- Modal copy: \"At least one agent API key is required to use Open Sprint. Or, select 'Custom/CLI' if you'll be using your own agent or a CLI integration rather than an API.\"\n- Provider dropdown: Claude, Cursor, Custom/CLI\n- If Claude or Cursor selected: show password-style text input (hidden by default, eye icon to reveal)\n- If Custom/CLI selected: no other inputs; Save proceeds immediately\n- On Save (Claude/Cursor): validate key via quick test API call; on success, save to global store and redirect to Create/Add Existing workflow\n- If Custom/CLI selected: persist `useCustomCli: true` in global settings; do not prompt for API keys on future Create/Add Existing\n- ApiKeyResolver reads from global store first, then project settings (backward compat), then process.env\n\n## Technical Approach\n\n### Global Settings Store\n\n- New file: `~/.opensprint/global-settings.json`\n- Schema: `{ apiKeys?: ApiKeys, useCustomCli?: boolean }`\n- New service: `GlobalSettingsService` with `get()`, `set()`, `update()`\n- Same `ApiKeys` / `ApiKeyEntry` structure as project settings (id, value, limitHitAt)\n\n### ApiKeyResolver Changes\n\n- `getNextKey(projectId, provider)`: 1) global store apiKeys, 2) project settings apiKeys, 3) process.env\n- `recordLimitHit` / `clearLimitHit`: update global store when key came from global; project store when from project\n\n### Modal Flow\n\n- HomeScreen and Navbar: before navigating to `/projects/create-new` or `/projects/add-existing`, call `GET /env/global-status`\n- Response: `{ hasAnyKey: boolean, useCustomCli: boolean }` â€” hasAnyKey true if any API key in global store or .env; useCustomCli from global settings\n- If `!hasAnyKey && !useCustomCli`: show `ApiKeySetupModal` instead of navigating\n- Modal: Provider dropdown (Claude, Cursor, Custom/CLI)\n- Claude/Cursor: password input with eye toggle; Save calls `POST /env/keys/validate` then `POST /env/keys` (or new combined endpoint)\n- Custom/CLI: Save calls `PUT /env/global-settings` with `{ useCustomCli: true }`\n- On success: close modal, navigate to intended route (Create New or Add Existing)\n\n### API Key Validation\n\n- New endpoint: `POST /env/keys/validate` â€” body `{ provider: \"claude\" | \"cursor\", value: string }`\n- Returns `{ valid: boolean, error?: string }`\n- Uses same logic as models route: Claude â†’ list models (limit 1); Cursor â†’ `GET /v0/models`\n\n### Env Route Updates\n\n- `POST /env/keys`: save to global store (and optionally .env for backward compat)\n- `GET /env/keys`: extend to include global store keys in presence check\n- New: `GET /env/global-status` â€” `{ hasAnyKey, useCustomCli }`\n- New: `PUT /env/global-settings` â€” body `{ useCustomCli?: boolean }`\n\n## Dependencies\n\n- `@anthropic-ai/sdk` (existing) for Claude validation\n- `fetch` for Cursor validation\n- No new npm packages\n\n## Data Model Changes\n\n### New: GlobalSettings\n\n| Field | Type | Description |\n|-------|------|-------------|\n| apiKeys | ApiKeys | Per-provider keys with limitHitAt (same as ProjectSettings) |\n| useCustomCli | boolean | When true, user opted for Custom/CLI; skip API key prompts |\n\n### Storage\n\n- Path: `~/.opensprint/global-settings.json`\n- Schema: `{ apiKeys?: ApiKeys, useCustomCli?: boolean }`\n\n## API Specification\n\n### GET /api/v1/env/global-status\n\n**Response:** `200 OK`\n\n```json\n{\n  \"data\": {\n    \"hasAnyKey\": true,\n    \"useCustomCli\": false\n  }\n}\n```\n\n- `hasAnyKey`: true if global store has at least one non-empty key for ANTHROPIC/CURSOR, or process.env has them, or claudeCli available\n- `useCustomCli`: from global settings\n\n### POST /api/v1/env/keys/validate\n\n**Request:** `application/json`\n\n```json\n{\n  \"provider\": \"claude\",\n  \"value\": \"sk-ant-...\"\n}\n```\n\n**Response:** `200 OK`\n\n```json\n{\n  \"data\": { \"valid\": true }\n}\n```\n\n**Response (invalid):** `200 OK`\n\n```json\n{\n  \"data\": { \"valid\": false, \"error\": \"Invalid API key\" }\n}\n```\n\n### PUT /api/v1/env/global-settings\n\n**Request:** `application/json`\n\n```json\n{\n  \"useCustomCli\": true\n}\n```\n\n**Response:** `200 OK`\n\n```json\n{\n  \"data\": { \"saved\": true }\n}\n```\n\n### POST /api/v1/env/keys (updated)\n\n- Continue to accept `{ key, value }`\n- Additionally persist to global store (merge with existing global apiKeys)\n- Existing .env write retained for backward compat\n\n## UI/UX Requirements\n\n- Modal: centered overlay, max-width 400px\n- Title: \"Enter agent API key\"\n- Body: explanatory copy above Provider dropdown\n- Provider dropdown: \"Claude\", \"Cursor\", \"Custom/CLI\"\n- Password input: `type=\"password\"` by default; eye icon toggles visibility\n- Save button: disabled when Claude/Cursor selected and input empty\n- Loading state on Save: \"Validating...\" or spinner while validating\n- Error display: inline below input when validation fails\n- Cancel button: closes modal, returns to project list (no navigation)\n\n## Edge Cases and Error Handling\n\n- Validation fails: show error message; do not save; user can correct and retry\n- Network error during validation: show \"Could not connect. Check your connection and try again.\"\n- 401/403 from provider: show provider-specific hint (e.g. \"Check that your API key is valid. Get one from Cursor â†’ Settings â†’ Integrations.\")\n- User selects Custom/CLI then later wants API: they can add keys via Project Settings (existing flow) or a future Global Settings UI\n- Global settings file corrupt or missing: treat as empty; allow user to proceed through modal\n- Backend restart: global store persists; no special handling\n\n## Testing Strategy\n\n- Unit: GlobalSettingsService read/write; ApiKeyResolver with global store fallback\n- Unit: ApiKeySetupModal rendering; provider change shows/hides input; Custom/CLI Save without input\n- Integration: POST /env/keys/validate with valid/invalid keys; PUT /env/global-settings\n- Integration: GET /env/global-status returns correct hasAnyKey/useCustomCli\n- E2E: Create New with no keys â†’ modal shows â†’ add Claude key â†’ validate â†’ redirect to Create New\n- E2E: Add Existing with no keys â†’ modal â†’ select Custom/CLI â†’ Save â†’ redirect to Add Existing\n- E2E: Second Create New after Custom/CLI â†’ no modal, direct to Create New\n\n## Estimated Complexity\n\n**Plan-level:** medium",
  "complexity": "medium",
  "mockups": [
    {
      "title": "API Key Setup Modal â€” Initial",
      "content": "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Enter agent API key                                                    [ Ã— ]  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                              â”‚\nâ”‚  At least one agent API key is required to use Open Sprint. Or, select      â”‚\nâ”‚  'Custom/CLI' if you'll be using your own agent or a CLI integration        â”‚\nâ”‚  rather than an API.                                                         â”‚\nâ”‚                                                                              â”‚\nâ”‚  Provider                                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ Claude                                                          â–¼   â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                                                              â”‚\nâ”‚  API Key                                                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢ â”‚ ğŸ‘ â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                                                              â”‚\nâ”‚  [ Cancel ]                                              [ Save ]            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
    },
    {
      "title": "API Key Setup Modal â€” Custom/CLI Selected",
      "content": "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Enter agent API key                                                    [ Ã— ]  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                              â”‚\nâ”‚  At least one agent API key is required to use Open Sprint. Or, select      â”‚\nâ”‚  'Custom/CLI' if you'll be using your own agent or a CLI integration        â”‚\nâ”‚  rather than an API.                                                         â”‚\nâ”‚                                                                              â”‚\nâ”‚  Provider                                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ Custom/CLI                                                       â–¼   â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                                                              â”‚\nâ”‚  (No API key input shown â€” Custom/CLI uses your own agent.)                  â”‚\nâ”‚                                                                              â”‚\nâ”‚  [ Cancel ]                                              [ Save ]            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
    },
    {
      "title": "API Key Setup Modal â€” Validation Error",
      "content": "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Enter agent API key                                                    [ Ã— ]  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                              â”‚\nâ”‚  Provider                                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ Cursor                                                          â–¼   â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                                                              â”‚\nâ”‚  API Key                                                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ invalid-key                                                      ğŸ‘ â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ âš  Invalid API key. Check Cursor â†’ Settings â†’ Integrations â†’ User   â”‚    â”‚\nâ”‚  â”‚   API Keys.                                                          â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                                                              â”‚\nâ”‚  [ Cancel ]                                              [ Save ]            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
    }
  ],
  "tasks": [
    {
      "title": "Add GlobalSettingsService and global-settings.json",
      "description": "Create GlobalSettingsService with get/set/update for ~/.opensprint/global-settings.json. Schema: { apiKeys?: ApiKeys, useCustomCli?: boolean }. Use same ApiKeyEntry structure for apiKeys. Add atomic write. Unit tests for read/write.",
      "priority": 0,
      "dependsOn": [],
      "complexity": "simple"
    },
    {
      "title": "Add GET /env/global-status and PUT /env/global-settings",
      "description": "New endpoint GET /env/global-status: returns { hasAnyKey, useCustomCli }. hasAnyKey = global store has keys OR process.env has ANTHROPIC/CURSOR OR claudeCli available. Add PUT /env/global-settings for { useCustomCli }. Wire to GlobalSettingsService.",
      "priority": 1,
      "dependsOn": ["Add GlobalSettingsService and global-settings.json"],
      "complexity": "simple"
    },
    {
      "title": "Add POST /env/keys/validate endpoint",
      "description": "New endpoint POST /env/keys/validate with body { provider: 'claude'|'cursor', value: string }. Validate via minimal API call (Claude: list models limit 1; Cursor: GET /v0/models). Return { valid: boolean, error?: string }. Reuse existing fetch logic from models route.",
      "priority": 2,
      "dependsOn": [],
      "complexity": "simple"
    },
    {
      "title": "Update POST /env/keys to persist to global store",
      "description": "Extend POST /env/keys to also write to global store (merge with existing global apiKeys). Keep .env write for backward compat. Generate unique id for new ApiKeyEntry (e.g. crypto.randomUUID).",
      "priority": 3,
      "dependsOn": ["Add GlobalSettingsService and global-settings.json"],
      "complexity": "simple"
    },
    {
      "title": "Update ApiKeyResolver to read from global store first",
      "description": "Modify getNextKey: 1) global store apiKeys, 2) project settings apiKeys, 3) process.env. Update recordLimitHit/clearLimitHit to write to global store when key came from global; project store when from project. Add keyId/source tracking to distinguish.",
      "priority": 4,
      "dependsOn": ["Add GlobalSettingsService and global-settings.json"],
      "complexity": "complex"
    },
    {
      "title": "Update GET /env/keys to reflect global store",
      "description": "Extend GET /env/keys to check global store keys in addition to process.env. Return anthropic/cursor true if any source has them. Add useCustomCli to response or keep separate global-status endpoint.",
      "priority": 5,
      "dependsOn": ["Add GlobalSettingsService and global-settings.json", "Add GET /env/global-status and PUT /env/global-settings"],
      "complexity": "simple"
    },
    {
      "title": "Create ApiKeySetupModal component",
      "description": "Modal with title 'Enter agent API key', body copy, Provider dropdown (Claude, Cursor, Custom/CLI). If Claude/Cursor: password input with eye icon toggle. Save/Cancel. On Save: Claude/Cursor call validate then save; Custom call PUT global-settings. On success: onComplete callback; close modal. Props: onComplete, onCancel, intendedRoute.",
      "priority": 6,
      "dependsOn": [],
      "complexity": "simple"
    },
    {
      "title": "Add api.env methods for global-status, validate, global-settings",
      "description": "Frontend api client: getGlobalStatus(), validateKey(provider, value), setGlobalSettings({ useCustomCli }).",
      "priority": 7,
      "dependsOn": [],
      "complexity": "simple"
    },
    {
      "title": "Intercept Create New / Add Existing with global-status check",
      "description": "HomeScreen: before navigate to Create New or Add Existing, call getGlobalStatus(). If !hasAnyKey && !useCustomCli, show ApiKeySetupModal instead. On modal complete, navigate to intended route. Navbar: same logic when creating from project context. Pass intendedRoute to modal.",
      "priority": 8,
      "dependsOn": ["Create ApiKeySetupModal component", "Add api.env methods for global-status, validate, global-settings", "Add GET /env/global-status and PUT /env/global-settings"],
      "complexity": "simple"
    },
    {
      "title": "Add ApiKeySetupModal validation and error handling",
      "description": "Wire Save: call validateKey for Claude/Cursor; show loading state; on validation error display inline below input; on success call saveKey then onComplete. Handle network errors with user-friendly message.",
      "priority": 9,
      "dependsOn": ["Create ApiKeySetupModal component", "Add api.env methods for global-status, validate, global-settings"],
      "complexity": "simple"
    },
    {
      "title": "Add ApiKeySetupModal and env route tests",
      "description": "Unit tests: ApiKeySetupModal renders, provider change toggles input, Custom/CLI Save without input. Integration: POST /env/keys/validate with valid/invalid keys; PUT /env/global-settings; GET /env/global-status. E2E: full flow Create New with no keys â†’ modal â†’ add key â†’ redirect.",
      "priority": 10,
      "dependsOn": ["Intercept Create New / Add Existing with global-status check", "Add ApiKeySetupModal validation and error handling"],
      "complexity": "simple"
    }
  ]
}
